<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <title>GreenCycle - ë¬´ë£Œë‚˜ëˆ” ì»¤ë®¤ë‹ˆí‹°</title>
    <!-- CSS íŒŒì¼ ë§í¬ - Thymeleaf ì •ì  ë¦¬ì†ŒìŠ¤ ê²½ë¡œ -->
    <link rel="stylesheet" th:href="@{/css/freesharing.css}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>

<body>
    <!-- Header -->
    <header class="header" id="header">
        <nav class="navbar">
            <div class="nav-container">
                <!-- ë¡œê³  - Thymeleaf URL ì²˜ë¦¬ -->
                <a th:href="@{/}" class="logo">
                    <img th:src="@{/img/logo.png}" alt="GreenCycle ë¡œê³ " class="logo-img">
                </a>
                <ul class="nav-menu" id="navMenu">
                    <li><a th:href="@{/}">í™ˆ</a></li>
                    <li><a th:href="@{/waste-sorting}">ë¶„ë¦¬ë°°ì¶œ</a></li>
                    <li><a th:href="@{/free-sharing}" class="active">ë¬´ë£Œë‚˜ëˆ”</a></li>
                    <li><a th:href="@{/eco-market}">ì—ì½”ë§ˆì¼“</a></li>
                    <li><a th:href="@{/eco-talk}">í™˜ê²½í†¡í†¡</a></li>
                    <li><a th:href="@{/notices}">ê³µì§€ì‚¬í•­</a></li>
                </ul>
                <!-- ë¡œê·¸ì¸ ìƒíƒœì— ë”°ë¥¸ ì¡°ê±´ë¶€ í‘œì‹œ -->
                <div class="auth-buttons">
                    <!-- ë¡œê·¸ì¸í•œ ê²½ìš° -->
                    <div th:if="${session.user}" class="user-menu">
                        <span th:text="${session.user.nickname + 'ë‹˜'}">ì‚¬ìš©ìë‹˜</span>
                        <a th:href="@{/logout}" class="btn-logout">ë¡œê·¸ì•„ì›ƒ</a>
                    </div>
                    <!-- ë¹„ë¡œê·¸ì¸ ìƒíƒœ -->
                    <div th:unless="${session.user}" class="guest-menu">
                        <a th:href="@{/login}" class="btn-login">ë¡œê·¸ì¸</a>
                        <a th:href="@{/signup}" class="btn-signup">íšŒì›ê°€ì…</a>
                    </div>
                </div>
                <div class="hamburger" id="hamburger">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Hero Section -->
        <section class="hero-section">
            <div class="container">
                <div class="hero-content">
                    <h1>ğŸ¤ ë¬´ë£Œë‚˜ëˆ” ì»¤ë®¤ë‹ˆí‹°</h1>
                    <p>ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ë¬¼ê±´ì„ ì´ì›ƒê³¼ ë‚˜ëˆ„ë©° ìì› ìˆœí™˜ì„ ì‹¤í˜„í•˜ì„¸ìš”</p>
                    <!-- í†µê³„ í‘œì‹œ ì˜ì—­ - ì„œë²„ì—ì„œ ì „ë‹¬ë°›ì€ í†µê³„ ë°ì´í„° -->
                    <div class="hero-stats">
                        <div class="stat-item">
                            <span class="stat-number" th:text="${sharingStats.todayCompleted}">1,247</span>
                            <span class="stat-label">ì˜¤ëŠ˜ ë‚˜ëˆ” ì™„ë£Œ</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" th:text="${#numbers.formatInteger(sharingStats.totalShared, 3, 'COMMA')}">15,382</span>
                            <span class="stat-label">ì´ ë‚˜ëˆ” ê±´ìˆ˜</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" th:text="${#numbers.formatInteger(sharingStats.activeMembers, 3, 'COMMA')}">8,941</span>
                            <span class="stat-label">í™œì„± íšŒì›</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Filter and Actions -->
        <section class="filter-section">
            <div class="container">
                <div class="filter-header">
                    <div class="filter-left">
                        <h2>ìš°ë¦¬ ë™ë„¤ ë‚˜ëˆ”</h2>
                        <!-- ì‚¬ìš©ì ìœ„ì¹˜ ì •ë³´ í‘œì‹œ -->
                        <p th:text="'ğŸ“ ' + ${session.user != null ? session.user.location : 'ìœ„ì¹˜ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”'}">ğŸ“ ì„œìš¸ ê°•ë‚¨êµ¬ ì—­ì‚¼ë™</p>
                    </div>
                    <div class="filter-right">
                        <!-- ë‚˜ëˆ” ë“±ë¡ ë²„íŠ¼ - ë¡œê·¸ì¸í•œ ì‚¬ìš©ìë§Œ í‘œì‹œ -->
                        <button class="btn btn-primary" id="addItemBtn" th:if="${session.user}" 
                                th:onclick="|location.href='@{/free-sharing/register}'|">
                            <span>+</span> ë‚˜ëˆ” ë“±ë¡
                        </button>
                        <a th:href="@{/login}" class="btn btn-primary" th:unless="${session.user}">
                            <span>+</span> ë¡œê·¸ì¸í•˜ì—¬ ë‚˜ëˆ” ë“±ë¡
                        </a>
                    </div>
                </div>
                
                <!-- í•„í„° ì»¨íŠ¸ë¡¤ ì˜ì—­ - í¼ìœ¼ë¡œ ê°ì‹¸ì„œ ì„œë²„ì— ì „ì†¡ -->
                <form th:action="@{/free-sharing}" method="get" id="filterForm">
                    <div class="filter-controls">
                        <div class="filter-group">
                            <label>ì¹´í…Œê³ ë¦¬</label>
                            <select id="categoryFilter" name="category" th:value="${searchParams.category}">
                                <option value="">ì „ì²´</option>
                                <!-- ì„œë²„ì—ì„œ ì „ë‹¬ë°›ì€ ì¹´í…Œê³ ë¦¬ ëª©ë¡ ì¶œë ¥ -->
                                <option th:each="cat : ${categories}" 
                                        th:value="${cat.code}" 
                                        th:text="${cat.name}"
                                        th:selected="${cat.code == searchParams.category}">ì˜ë¥˜/ì¡í™”</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label>ê±°ë¦¬</label>
                            <select id="distanceFilter" name="distance" th:value="${searchParams.distance}">
                                <option value="">ì „ì²´</option>
                                <option value="500" th:selected="${searchParams.distance == '500'}">500m ì´ë‚´</option>
                                <option value="1000" th:selected="${searchParams.distance == '1000'}">1km ì´ë‚´</option>
                                <option value="3000" th:selected="${searchParams.distance == '3000'}">3km ì´ë‚´</option>
                                <option value="5000" th:selected="${searchParams.distance == '5000'}">5km ì´ë‚´</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label>ìƒíƒœ</label>
                            <select id="statusFilter" name="status" th:value="${searchParams.status}">
                                <option value="">ì „ì²´</option>
                                <option value="AVAILABLE" th:selected="${searchParams.status == 'AVAILABLE'}">ë‚˜ëˆ”ì¤‘</option>
                                <option value="RESERVED" th:selected="${searchParams.status == 'RESERVED'}">ì˜ˆì•½ì¤‘</option>
                                <option value="COMPLETED" th:selected="${searchParams.status == 'COMPLETED'}">ì™„ë£Œ</option>
                            </select>
                        </div>
                        
                        <div class="search-group">
                            <input type="text" id="searchInput" name="keyword" 
                                   th:value="${searchParams.keyword}"
                                   placeholder="ì›í•˜ëŠ” ë¬¼ê±´ì„ ê²€ìƒ‰í•˜ì„¸ìš”...">
                            <button type="submit" class="search-btn">ğŸ”</button>
                        </div>
                    </div>
                </form>
            </div>
        </section>

        <!-- Items Grid -->
        <section class="items-section">
            <div class="container">
                <div class="items-header">
                    <div class="items-count">
                        <!-- ê²€ìƒ‰ ê²°ê³¼ ê°œìˆ˜ í‘œì‹œ -->
                        <span id="totalItems" th:text="'ì´ ' + ${#numbers.formatInteger(sharingItems.totalElements, 0, 'COMMA')} + 'ê°œ'">ì´ 47ê°œ</span>ì˜ ë‚˜ëˆ” ë¬¼ê±´
                    </div>
                    <div class="sort-options">
                        <select id="sortSelect" name="sort" onchange="changeSort(this.value)">
                            <option value="recent" th:selected="${searchParams.sort == 'recent'}">ìµœì‹ ìˆœ</option>
                            <option value="distance" th:selected="${searchParams.sort == 'distance'}">ê±°ë¦¬ìˆœ</option>
                            <option value="popular" th:selected="${searchParams.sort == 'popular'}">ì¸ê¸°ìˆœ</option>
                        </select>
                    </div>
                </div>
                
                <!-- ë‚˜ëˆ” ì•„ì´í…œ ê·¸ë¦¬ë“œ - Thymeleaf ë°˜ë³µë¬¸ìœ¼ë¡œ ë™ì  ìƒì„± -->
                <div class="items-grid" id="itemsGrid">
                    <!-- ë‚˜ëˆ” ì•„ì´í…œì´ ì—†ì„ ë•Œ í‘œì‹œ -->
                    <div th:if="${#lists.isEmpty(sharingItems.content)}" class="no-items">
                        <div class="no-items-content">
                            <h3>ğŸ˜” ê²€ìƒ‰ ì¡°ê±´ì— ë§ëŠ” ë‚˜ëˆ”ì´ ì—†ìŠµë‹ˆë‹¤</h3>
                            <p>ë‹¤ë¥¸ ì¡°ê±´ìœ¼ë¡œ ê²€ìƒ‰í•´ë³´ì‹œê±°ë‚˜, ì§ì ‘ ë‚˜ëˆ”ì„ ë“±ë¡í•´ë³´ì„¸ìš”!</p>
                            <a th:href="@{/free-sharing/register}" class="btn btn-primary" th:if="${session.user}">
                                ë‚˜ëˆ” ë“±ë¡í•˜ê¸°
                            </a>
                        </div>
                    </div>
                    
                    <!-- ë‚˜ëˆ” ì•„ì´í…œ ì¹´ë“œë“¤ - ë°˜ë³µë¬¸ìœ¼ë¡œ ì¶œë ¥ -->
                    <div class="sharing-card" th:each="item : ${sharingItems.content}" 
                         th:onclick="|location.href='@{/free-sharing/detail/{id}(id=${item.id})}'|">
                        <!-- ë‚˜ëˆ” ì•„ì´í…œ ì´ë¯¸ì§€ -->
                        <div class="item-image">
                            <img th:src="${item.mainImageUrl != null ? item.mainImageUrl : '/img/default-sharing.svg'}" 
                                 th:alt="${item.title}">
                            <!-- ë‚˜ëˆ” ìƒíƒœ ë°°ì§€ -->
                            <div class="item-status" 
                                 th:classappend="${item.status == 'AVAILABLE' ? 'status-available' : (item.status == 'RESERVED' ? 'status-reserved' : 'status-completed')}"
                                 th:text="${item.status == 'AVAILABLE' ? 'ë‚˜ëˆ”ì¤‘' : (item.status == 'RESERVED' ? 'ì˜ˆì•½ì¤‘' : 'ì™„ë£Œ')}">ë‚˜ëˆ”ì¤‘</div>
                        </div>
                        
                        <!-- ë‚˜ëˆ” ì•„ì´í…œ ì •ë³´ -->
                        <div class="item-info">
                            <h3 class="item-title" th:text="${item.title}">ë‚˜ëˆ” ì•„ì´í…œ ì œëª©</h3>
                            <div class="item-meta">
                                <!-- ì¹´í…Œê³ ë¦¬ -->
                                <span class="item-category" th:text="${item.categoryName}">ê°€êµ¬/ì¸í…Œë¦¬ì–´</span>
                                <!-- ìƒí’ˆ ìƒíƒœ -->
                                <span class="item-condition" th:text="${item.conditionText}">ìƒíƒœ ì¢‹ìŒ</span>
                            </div>
                            
                            <!-- ìœ„ì¹˜ ë° ì‹œê°„ ì •ë³´ -->
                            <div class="item-location">
                                <span th:text="'ğŸ“ ' + ${item.location}">ğŸ“ ì„œìš¸ ê°•ë‚¨êµ¬ ì—­ì‚¼ë™</span>
                                <span class="item-time" th:text="${item.timeAgo}">10ë¶„ ì „</span>
                            </div>
                            
                            <!-- ê´€ì‹¬ ë° ì¡°íšŒ ì •ë³´ -->
                            <div class="item-stats">
                                <span class="stat-item">
                                    <span class="stat-icon">ğŸ’–</span>
                                    <span th:text="${item.likeCount}">12</span>
                                </span>
                                <span class="stat-item">
                                    <span class="stat-icon">ğŸ’¬</span>
                                    <span th:text="${item.commentCount}">3</span>
                                </span>
                                <span class="stat-item">
                                    <span class="stat-icon">ğŸ‘ï¸</span>
                                    <span th:text="${item.viewCount}">45</span>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ë”ë³´ê¸° ë²„íŠ¼ - í˜ì´ì§€ë„¤ì´ì…˜ì´ ìˆì„ ê²½ìš° í‘œì‹œ -->
                <div class="load-more" th:if="${sharingItems.hasNext()}">
                    <button class="btn btn-secondary" id="loadMoreBtn" 
                            th:onclick="|loadMoreItems(${sharingItems.number + 1})|">ë” ë§ì€ ë‚˜ëˆ” ë³´ê¸°</button>
                </div>

                <!-- í˜ì´ì§€ë„¤ì´ì…˜ ì˜ì—­ -->
                <div class="pagination" id="pagination" th:if="${sharingItems.totalPages > 1}">
                    <!-- ì´ì „ í˜ì´ì§€ -->
                    <a th:href="@{/free-sharing(page=${sharingItems.number - 1}, category=${searchParams.category}, keyword=${searchParams.keyword})}" 
                       class="page-btn" th:if="${sharingItems.hasPrevious()}">â€¹</a>
                    
                    <!-- í˜ì´ì§€ ë²ˆí˜¸ë“¤ -->
                    <th:block th:each="pageNum : ${#numbers.sequence(0, sharingItems.totalPages - 1)}">
                        <a th:href="@{/free-sharing(page=${pageNum}, category=${searchParams.category}, keyword=${searchParams.keyword})}" 
                           class="page-btn" 
                           th:classappend="${pageNum == sharingItems.number ? 'active' : ''}"
                           th:text="${pageNum + 1}">1</a>
                    </th:block>
                    
                    <!-- ë‹¤ìŒ í˜ì´ì§€ -->
                    <a th:href="@{/free-sharing(page=${sharingItems.number + 1}, category=${searchParams.category}, keyword=${searchParams.keyword})}" 
                       class="page-btn" th:if="${sharingItems.hasNext()}">â€º</a>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <div class="logo" style="margin-bottom: 20px;">
                        <span class="logo-icon">ğŸŒ±</span>
                        <span class="logo-text">GreenCycle</span>
                    </div>
                    <p>ì²¨ë‹¨ ê¸°ìˆ ë¡œ ì‹¤í˜„í•˜ëŠ” ìŠ¤ë§ˆíŠ¸í•˜ê³  ì§€ì† ê°€ëŠ¥í•œ í™˜ê²½ í”Œë«í¼</p>
                </div>
                <div class="footer-section">
                    <h4>ì„œë¹„ìŠ¤</h4>
                    <ul>
                        <li><a th:href="@{/waste-sorting}">ìŠ¤ë§ˆíŠ¸ ë¶„ë¦¬ë°°ì¶œ</a></li>
                        <li><a th:href="@{/free-sharing}">ë¬´ë£Œë‚˜ëˆ”</a></li>
                        <li><a th:href="@{/eco-market}">ì—ì½”ë§ˆì¼“</a></li>
                        <li><a th:href="@{/eco-talk}">í™˜ê²½í†¡í†¡</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>íšŒì‚¬ì •ë³´</h4>
                    <ul>
                        <li><a th:href="@{/about}">íšŒì‚¬ì†Œê°œ</a></li>
                        <li><a th:href="@{/patents}">ê¸°ìˆ  íŠ¹í—ˆ</a></li>
                        <li><a th:href="@{/research}">ì—°êµ¬ê°œë°œ</a></li>
                        <li><a th:href="@{/careers}">ì±„ìš©ì •ë³´</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>ê³ ê°ì§€ì›</h4>
                    <ul>
                        <li><a th:href="@{/contact}">ë¬¸ì˜í•˜ê¸°</a></li>
                        <li><a th:href="@{/guide}">ì´ìš©ê°€ì´ë“œ</a></li>
                        <li><a th:href="@{/support}">ê¸°ìˆ ì§€ì›</a></li>
                        <li><a th:href="@{/customer-service}">ê³ ê°ì„¼í„°</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 GreenCycle. All rights reserved.</p>
                <div class="footer-links">
                    <a th:href="@{/privacy-policy}">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a>
                    <a th:href="@{/terms}">ì´ìš©ì•½ê´€</a>
                </div>
            </div>
        </div>
    </footer>

    <!-- JavaScript íŒŒì¼ ì—°ê²° - Thymeleaf ì •ì  ë¦¬ì†ŒìŠ¤ ê²½ë¡œ -->
    <script th:src="@{/js/freesharing.js}"></script>
    
    <!-- í˜ì´ì§€ ë°ì´í„°ë¥¼ JavaScriptë¡œ ì „ë‹¬ -->
    <script th:inline="javascript">
        // ì„œë²„ì—ì„œ ì „ë‹¬ë°›ì€ ë°ì´í„°ë¥¼ JavaScript ë³€ìˆ˜ë¡œ ì„¤ì •
        var sharingItemsData = /*[[${sharingItems.content}]]*/ [];
        var searchParams = /*[[${searchParams}]]*/ {};
        var currentUser = /*[[${session.user}]]*/ null;
        var currentPage = /*[[${sharingItems.number}]]*/ 0;
        var totalPages = /*[[${sharingItems.totalPages}]]*/ 1;
        
        // ì „ì—­ ë³€ìˆ˜ë¡œ ì„¤ì •í•˜ì—¬ JavaScript í•¨ìˆ˜ë“¤ì—ì„œ ì‚¬ìš©
        window.sharingItemsData = sharingItemsData;
        window.searchParams = searchParams;
        window.currentUser = currentUser;
        window.currentPage = currentPage;
        window.totalPages = totalPages;
        
        // ì •ë ¬ ë³€ê²½ í•¨ìˆ˜
        function changeSort(sortValue) {
            var currentUrl = new URL(window.location);
            currentUrl.searchParams.set('sort', sortValue);
            currentUrl.searchParams.set('page', '0'); // ì •ë ¬ ë³€ê²½ì‹œ ì²« í˜ì´ì§€ë¡œ
            window.location.href = currentUrl.toString();
        }
        
        // ë”ë³´ê¸° í•¨ìˆ˜
        function loadMoreItems(page) {
            var currentUrl = new URL(window.location);
            currentUrl.searchParams.set('page', page);
            window.location.href = currentUrl.toString();
        }
    </script>
</body>
</html>