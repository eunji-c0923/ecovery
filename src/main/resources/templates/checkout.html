<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <title>GreenCycle - Ï£ºÎ¨∏/Í≤∞Ï†ú</title>
    <!-- Thymeleaf Ï†ïÏ†Å Î¶¨ÏÜåÏä§ Í≤ΩÎ°ú ÏÇ¨Ïö© -->
    <link rel="stylesheet" th:href="@{/css/checkout.css}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Header - Ïû•Î∞îÍµ¨ÎãàÏôÄ ÎèôÏùºÌïú Ìó§Îçî -->
    <header class="header" id="header">
        <nav class="navbar">
            <div class="nav-container">
                <!-- Î°úÍ≥† - Thymeleaf URL Í≤ΩÎ°ú Ï≤òÎ¶¨ -->
                <a th:href="@{/}" class="logo">
                    <img th:src="@{/img/logo.png}" alt="GreenCycle Î°úÍ≥†" class="logo-img">
                </a>
                <ul class="nav-menu" id="navMenu">
                    <li><a th:href="@{/#home}">Ìôà</a></li>
                    <li><a th:href="@{/#services}">ÏÑúÎπÑÏä§</a></li>
                    <li><a th:href="@{/waste-sorting}">Î∂ÑÎ¶¨Î∞∞Ï∂ú</a></li>
                    <li><a th:href="@{/free-sharing}">Î¨¥Î£åÎÇòÎàî</a></li>
                    <li><a th:href="@{/eco-market}" class="active">ÏóêÏΩîÎßàÏºì</a></li>
                    <li><a th:href="@{/eco-talk}">ÌôòÍ≤ΩÎèÖÌÜ°</a></li>
                    <li><a th:href="@{/notices}">Í≥µÏßÄÏÇ¨Ìï≠</a></li>
                </ul>
                <div class="auth-buttons">
                    <!-- Ïû•Î∞îÍµ¨Îãà ÏïÑÏù¥ÌÖú Í∞úÏàò ÎèôÏ†Å ÌëúÏãú -->
                    <a th:href="@{/cart}" class="cart-link">
                        <span class="cart-icon">üõí</span>
                        <span class="cart-count" id="cartCount" th:text="${cartItemCount}">3</span>
                    </a>
                    <!-- Î°úÍ∑∏Ïù∏ ÏÉÅÌÉúÏóê Îî∞Î•∏ Ï°∞Í±¥Î∂Ä ÌëúÏãú -->
                    <a th:href="@{/mypage}" class="btn-login" th:if="${session.user}">ÎßàÏù¥ÌéòÏù¥ÏßÄ</a>
                    <a th:href="@{/login}" class="btn-login" th:unless="${session.user}">Î°úÍ∑∏Ïù∏</a>
                    <a th:href="@{/logout}" class="btn-logout" th:if="${session.user}">Î°úÍ∑∏ÏïÑÏõÉ</a>
                </div>
                <div class="hamburger" id="hamburger">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <main id="mainContent">
        <!-- Í≤∞Ï†ú ÌéòÏù¥ÏßÄ Ìó§Îçî ÏÑπÏÖò -->
        <section class="checkout-header">
            <div class="container">
                <!-- ÌéòÏù¥ÏßÄ Í≤ΩÎ°ú ÌëúÏãú -->
                <div class="breadcrumb">
                    <a th:href="@{/}">Ìôà</a>
                    <span>></span>
                    <a th:href="@{/eco-market}">ÏóêÏΩîÎßàÏºì</a>
                    <span>></span>
                    <a th:href="@{/cart}">Ïû•Î∞îÍµ¨Îãà</a>
                    <span>></span>
                    <span class="current">Ï£ºÎ¨∏/Í≤∞Ï†ú</span>
                </div>
                <h1>üí≥ Ï£ºÎ¨∏/Í≤∞Ï†ú</h1>
                <p class="checkout-subtitle">ÏïàÏ†ÑÌïòÍ≥† Îπ†Î•∏ ÏπúÌôòÍ≤Ω Ï£ºÎ¨∏ Í≤∞Ï†ú</p>
            </div>
        </section>

        <!-- Í≤∞Ï†ú ÏßÑÌñâ Îã®Í≥Ñ ÌëúÏãú -->
        <section class="checkout-steps">
            <div class="container">
                <div class="steps-container">
                    <!-- 1Îã®Í≥Ñ: Ïû•Î∞îÍµ¨Îãà (ÏôÑÎ£åÎê®) -->
                    <div class="step completed">
                        <div class="step-number">1</div>
                        <div class="step-text">Ïû•Î∞îÍµ¨Îãà</div>
                    </div>
                    <div class="step-line completed"></div>
                    
                    <!-- 2Îã®Í≥Ñ: Ï£ºÎ¨∏/Í≤∞Ï†ú (ÌòÑÏû¨ ÏßÑÌñâÏ§ë) -->
                    <div class="step active">
                        <div class="step-number">2</div>
                        <div class="step-text">Ï£ºÎ¨∏/Í≤∞Ï†ú</div>
                    </div>
                    <div class="step-line"></div>
                    
                    <!-- 3Îã®Í≥Ñ: Ï£ºÎ¨∏ÏôÑÎ£å (ÎåÄÍ∏∞Ï§ë) -->
                    <div class="step">
                        <div class="step-number">3</div>
                        <div class="step-text">Ï£ºÎ¨∏ÏôÑÎ£å</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Í≤∞Ï†ú Î©îÏù∏ ÏΩòÌÖêÏ∏† -->
        <section class="checkout-content">
            <div class="container">
                <!-- Ï£ºÎ¨∏/Í≤∞Ï†ú Ìèº - Thymeleaf Ìèº Í∞ùÏ≤¥ Î∞îÏù∏Îî© -->
                <form th:action="@{/checkout/process}" th:object="${orderForm}" method="post" id="checkoutForm">
                    <div class="checkout-layout">
                        <!-- ÏôºÏ™Ω: Ï£ºÎ¨∏ Ï†ïÎ≥¥ ÏûÖÎ†• Ìèº -->
                        <div class="checkout-form">
                            
                            <!-- Î∞∞ÏÜ° Ï†ïÎ≥¥ ÏûÖÎ†• ÏÑπÏÖò -->
                            <div class="form-section">
                                <h3>üöö Î∞∞ÏÜ° Ï†ïÎ≥¥</h3>
                                
                                <!-- Î∞õÎäîÏÇ¨Îûå Ïù¥Î¶ÑÍ≥º Ïó∞ÎùΩÏ≤ò -->
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="receiverName">Î∞õÎäî Î∂Ñ Ïù¥Î¶Ñ *</label>
                                        <!-- Í∏∞Î≥∏Í∞íÏúºÎ°ú Î°úÍ∑∏Ïù∏Ìïú ÏÇ¨Ïö©Ïûê Ïù¥Î¶Ñ ÏÇ¨Ïö© -->
                                        <input type="text" th:field="*{receiverName}" id="receiverName" required 
                                               th:value="${session.user != null ? session.user.name : ''}"
                                               placeholder="Î∞õÎäî Î∂Ñ ÏÑ±Î™ÖÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî">
                                        <!-- Thymeleaf Ïú†Ìö®ÏÑ± Í≤ÄÏÇ¨ Ïò§Î•ò Î©îÏãúÏßÄ -->
                                        <div class="error-message" th:if="${#fields.hasErrors('receiverName')}" th:errors="*{receiverName}"></div>
                                    </div>
                                    <div class="form-group">
                                        <label for="receiverPhone">Ïó∞ÎùΩÏ≤ò *</label>
                                        <input type="tel" th:field="*{receiverPhone}" id="receiverPhone" required 
                                               th:value="${session.user != null ? session.user.phone : ''}"
                                               placeholder="010-0000-0000">
                                        <div class="error-message" th:if="${#fields.hasErrors('receiverPhone')}" th:errors="*{receiverPhone}"></div>
                                    </div>
                                </div>
                                
                                <!-- Î∞∞ÏÜ° Ï£ºÏÜå ÏûÖÎ†• -->
                                <div class="form-group">
                                    <label for="deliveryAddress">Î∞∞ÏÜ° Ï£ºÏÜå *</label>
                                    <div class="address-input">
                                        <input type="text" th:field="*{zipcode}" id="zipcode" placeholder="Ïö∞Ìé∏Î≤àÌò∏" readonly>
                                        <button type="button" class="btn-search-address" onclick="searchAddress()">
                                            Ï£ºÏÜå Í≤ÄÏÉâ
                                        </button>
                                    </div>
                                    <input type="text" th:field="*{address1}" id="address1" placeholder="Í∏∞Î≥∏ Ï£ºÏÜå" readonly>
                                    <input type="text" th:field="*{address2}" id="address2" placeholder="ÏÉÅÏÑ∏ Ï£ºÏÜåÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî">
                                    <div class="error-message" th:if="${#fields.hasErrors('address1')}" th:errors="*{address1}"></div>
                                </div>
                                
                                <!-- Î∞∞ÏÜ° Î©îÏãúÏßÄ ÏÑ†ÌÉù -->
                                <div class="form-group">
                                    <label for="deliveryMessage">Î∞∞ÏÜ° Î©îÏãúÏßÄ</label>
                                    <select th:field="*{deliveryMessage}" id="deliveryMessage" onchange="handleDeliveryMessageChange()">
                                        <option value="">Î∞∞ÏÜ° Î©îÏãúÏßÄÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî</option>
                                        <option value="door">Î¨∏ ÏïûÏóê ÎÜìÏïÑÏ£ºÏÑ∏Ïöî</option>
                                        <option value="guard">Í≤ΩÎπÑÏã§Ïóê Îß°Í≤®Ï£ºÏÑ∏Ïöî</option>
                                        <option value="call">Î∞∞ÏÜ° Ï†Ñ Ïó∞ÎùΩ Î∞îÎûçÎãàÎã§</option>
                                        <option value="custom">ÏßÅÏ†ë ÏûÖÎ†•</option>
                                    </select>
                                    <!-- ÏßÅÏ†ë ÏûÖÎ†• Ïãú ÎÇòÌÉÄÎÇòÎäî ÌÖçÏä§Ìä∏ÏóêÎ¶¨Ïñ¥ -->
                                    <textarea th:field="*{customMessage}" id="customMessage" 
                                             placeholder="ÏöîÏ≤≠ÏÇ¨Ìï≠ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî" style="display: none;"></textarea>
                                </div>
                            </div>

                            <!-- Í≤∞Ï†ú Ï†ïÎ≥¥ ÏûÖÎ†• ÏÑπÏÖò -->
                            <div class="form-section">
                                <h3>üí≥ Í≤∞Ï†ú Ï†ïÎ≥¥</h3>
                                
                                <!-- Í≤∞Ï†ú ÏàòÎã® ÏÑ†ÌÉù ÏòµÏÖòÎì§ -->
                                <div class="payment-methods">
                                    <!-- Ïã†Ïö©Ïπ¥Îìú Í≤∞Ï†ú ÏòµÏÖò -->
                                    <div class="payment-option">
                                        <input type="radio" th:field="*{paymentMethod}" value="CARD" id="card" onchange="handlePaymentMethodChange('card')">
                                        <label for="card" class="payment-label">
                                            <span class="payment-icon">üí≥</span>
                                            <div class="payment-info">
                                                <span class="payment-title">Ïã†Ïö©Ïπ¥Îìú</span>
                                                <span class="payment-desc">Ï¶âÏãú Í≤∞Ï†ú</span>
                                            </div>
                                        </label>
                                    </div>
                                    
                                    <!-- Î¨¥ÌÜµÏû•ÏûÖÍ∏à ÏòµÏÖò (Í∏∞Î≥∏ ÏÑ†ÌÉùÎê®) -->
                                    <div class="payment-option">
                                        <input type="radio" th:field="*{paymentMethod}" value="BANK" id="bank" checked onchange="handlePaymentMethodChange('bank')">
                                        <label for="bank" class="payment-label">
                                            <span class="payment-icon">üè¶</span>
                                            <div class="payment-info">
                                                <span class="payment-title">Î¨¥ÌÜµÏû•ÏûÖÍ∏à</span>
                                                <span class="payment-desc">ÏûÖÍ∏à ÌôïÏù∏ ÌõÑ Î∞∞ÏÜ°</span>
                                            </div>
                                        </label>
                                    </div>
                                    
                                    <!-- Ìè¨Ïù∏Ìä∏ Í≤∞Ï†ú ÏòµÏÖò -->
                                    <div class="payment-option">
                                        <input type="radio" th:field="*{paymentMethod}" value="POINT" id="point" onchange="handlePaymentMethodChange('point')">
                                        <label for="point" class="payment-label">
                                            <span class="payment-icon">üíé</span>
                                            <div class="payment-info">
                                                <span class="payment-title">Ìè¨Ïù∏Ìä∏ Í≤∞Ï†ú</span>
                                                <!-- ÏÇ¨Ïö©Ïûê Î≥¥Ïú† Ìè¨Ïù∏Ìä∏ ÎèôÏ†Å ÌëúÏãú -->
                                                <span class="payment-desc" th:text="'Î≥¥Ïú†: ' + ${#numbers.formatInteger(session.user.points, 3, 'COMMA')} + 'P'">Î≥¥Ïú†: 15,680P</span>
                                            </div>
                                        </label>
                                    </div>
                                </div>

                                <!-- Ïã†Ïö©Ïπ¥Îìú Ï†ïÎ≥¥ ÏûÖÎ†• Ìèº (Í∏∞Î≥∏ Ïà®ÍπÄ) -->
                                <div id="cardDetails" class="payment-details" style="display: none;">
                                    <h4>üí≥ Ïπ¥Îìú Ï†ïÎ≥¥ ÏûÖÎ†•</h4>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="cardNumber">Ïπ¥ÎìúÎ≤àÌò∏ *</label>
                                            <input type="text" th:field="*{cardNumber}" id="cardNumber" 
                                                   placeholder="0000-0000-0000-0000" maxlength="19">
                                        </div>
                                        <div class="form-group">
                                            <label for="cardExpiry">Ïú†Ìö®Í∏∞Í∞Ñ *</label>
                                            <input type="text" th:field="*{cardExpiry}" id="cardExpiry" 
                                                   placeholder="MM/YY" maxlength="5">
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="cardCvc">CVC *</label>
                                            <input type="text" th:field="*{cardCvc}" id="cardCvc" 
                                                   placeholder="000" maxlength="3">
                                        </div>
                                        <div class="form-group">
                                            <label for="cardPassword">Ïπ¥Îìú ÎπÑÎ∞ÄÎ≤àÌò∏ Ïïû 2ÏûêÎ¶¨ *</label>
                                            <input type="password" th:field="*{cardPassword}" id="cardPassword" 
                                                   placeholder="**" maxlength="2">
                                        </div>
                                    </div>
                                </div>

                                <!-- Î¨¥ÌÜµÏû•ÏûÖÍ∏à Ï†ïÎ≥¥ ÏûÖÎ†• Ìèº (Í∏∞Î≥∏ ÌëúÏãú) -->
                                <div id="bankDetails" class="payment-details">
                                    <h4>üè¶ ÏûÖÍ∏à Ï†ïÎ≥¥ ÏûÖÎ†•</h4>
                                    <div class="form-group">
                                        <label for="selectedBank">ÏûÖÍ∏à ÏùÄÌñâ ÏÑ†ÌÉù *</label>
                                        <select th:field="*{selectedBank}" id="selectedBank" required>
                                            <option value="">ÏùÄÌñâÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî</option>
                                            <!-- ÏÑúÎ≤ÑÏóêÏÑú Ï†ÑÎã¨Î∞õÏùÄ ÏùÄÌñâ Î™©Î°ù Ï∂úÎ†• -->
                                            <option th:each="bank : ${availableBanks}" 
                                                    th:value="${bank.code}" 
                                                    th:text="${bank.name} + ' (' + ${bank.accountNumber} + ')'">Íµ≠ÎØºÏùÄÌñâ (123-45-67890-123)</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="depositorName">ÏûÖÍ∏àÏûêÎ™Ö *</label>
                                        <input type="text" th:field="*{depositorName}" id="depositorName" 
                                               th:value="${session.user != null ? session.user.name : ''}"
                                               placeholder="ÏûÖÍ∏àÏûêÎ™ÖÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî" required>
                                    </div>
                                    <!-- ÏûÖÍ∏à ÏïàÎÇ¥ Ï†ïÎ≥¥ -->
                                    <div class="bank-info">
                                        <div class="deposit-notice">
                                            <p><strong>üìå ÏûÖÍ∏à ÏïàÎÇ¥:</strong></p>
                                            <ul>
                                                <li>ÏûÖÍ∏àÏûêÎ™ÖÏùÄ Ï£ºÎ¨∏ÏûêÎ™ÖÍ≥º ÎèôÏùºÌï¥Ïïº Ìï©ÎãàÎã§.</li>
                                                <li>ÏûÖÍ∏à ÌôïÏù∏ ÌõÑ Î∞∞ÏÜ°Ïù¥ ÏãúÏûëÎê©ÎãàÎã§.</li>
                                                <li>3Ïùº Ïù¥ÎÇ¥ ÏûÖÍ∏àÌïòÏßÄ ÏïäÏúºÎ©¥ Ï£ºÎ¨∏Ïù¥ ÏûêÎèô Ï∑®ÏÜåÎê©ÎãàÎã§.</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>

                                <!-- Ìè¨Ïù∏Ìä∏ Í≤∞Ï†ú Ï†ïÎ≥¥ ÏûÖÎ†• Ìèº (Í∏∞Î≥∏ Ïà®ÍπÄ) -->
                                <div id="pointDetails" class="payment-details" style="display: none;">
                                    <h4>üíé Ìè¨Ïù∏Ìä∏ ÏÇ¨Ïö©</h4>
                                    <!-- Î≥¥Ïú† Ìè¨Ïù∏Ìä∏ ÌëúÏãú -->
                                    <div class="point-balance">
                                        <div class="balance-info">
                                            <span class="balance-label">Î≥¥Ïú† Ìè¨Ïù∏Ìä∏</span>
                                            <span class="balance-amount" th:text="${#numbers.formatInteger(session.user.points, 3, 'COMMA')} + 'P'">15,680P</span>
                                        </div>
                                    </div>
                                    <!-- ÏÇ¨Ïö©Ìï† Ìè¨Ïù∏Ìä∏ ÏûÖÎ†• -->
                                    <div class="form-group">
                                        <label for="usePoints">ÏÇ¨Ïö©Ìï† Ìè¨Ïù∏Ìä∏ *</label>
                                        <div class="point-input-group">
                                            <input type="number" th:field="*{usePoints}" id="usePoints" 
                                                   placeholder="0" min="0" th:max="${session.user.points}" 
                                                   onchange="calculateRemainingAmount()">
                                            <span class="point-unit">P</span>
                                            <button type="button" class="btn-use-all-points" 
                                                    th:onclick="|useAllPoints(${session.user.points})|">
                                                Ï†ÑÏï° ÏÇ¨Ïö©
                                            </button>
                                        </div>
                                        <!-- Ìè¨Ïù∏Ìä∏ ÏÇ¨Ïö© ÏïàÎÇ¥ -->
                                        <div class="point-notice">
                                            <p>‚Ä¢ ÏµúÏÜå 1,000PÎ∂ÄÌÑ∞ ÏÇ¨Ïö© Í∞ÄÎä•Ìï©ÎãàÎã§.</p>
                                            <p>‚Ä¢ 1P = 1ÏõêÏúºÎ°ú Í≥ÑÏÇ∞Îê©ÎãàÎã§.</p>
                                        </div>
                                    </div>
                                    <!-- Ìè¨Ïù∏Ìä∏ ÏÇ¨Ïö© ÌõÑ ÎÇ®ÏùÄ Í≤∞Ï†ú Í∏àÏï° ÌëúÏãú -->
                                    <div class="remaining-amount" id="remainingAmount">
                                        <div class="amount-row">
                                            <span>Ìè¨Ïù∏Ìä∏ ÏÇ¨Ïö©</span>
                                            <span id="pointUsage">0P</span>
                                        </div>
                                        <div class="amount-row">
                                            <span>ÎÇ®ÏùÄ Í≤∞Ï†úÍ∏àÏï°</span>
                                            <span id="remainingPayment" th:text="${#numbers.formatInteger(orderSummary.total, 3, 'COMMA')} + 'Ïõê'">47,000Ïõê</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Ïù¥Ïö©ÏïΩÍ¥Ä ÎèôÏùò ÏÑπÏÖò -->
                            <div class="form-section">
                                <h3>üìã Ï£ºÎ¨∏ ÎèôÏùò</h3>
                                <div class="agreement-section">
                                    <!-- Ï†ÑÏ≤¥ ÎèôÏùò Ï≤¥ÌÅ¨Î∞ïÏä§ -->
                                    <label class="agreement-item">
                                        <input type="checkbox" id="agreeAll" onclick="toggleAllAgreements()">
                                        <span class="checkmark"></span>
                                        <span class="agreement-text">Ï†ÑÏ≤¥ ÎèôÏùò</span>
                                    </label>
                                    
                                    <!-- Í∞úÎ≥Ñ ÎèôÏùò Ìï≠Î™©Îì§ -->
                                    <label class="agreement-item">
                                        <input type="checkbox" th:field="*{agreeOrder}" class="agreement-checkbox" required>
                                        <span class="checkmark"></span>
                                        <span class="agreement-text">Ï£ºÎ¨∏ ÎÇ¥Ïö© ÌôïÏù∏ Î∞è Í≤∞Ï†ú ÎèôÏùò (ÌïÑÏàò)</span>
                                    </label>
                                    
                                    <label class="agreement-item">
                                        <input type="checkbox" th:field="*{agreePrivacy}" class="agreement-checkbox" required>
                                        <span class="checkmark"></span>
                                        <span class="agreement-text">Í∞úÏù∏Ï†ïÎ≥¥ ÏàòÏßë Ïù¥Ïö© ÎèôÏùò (ÌïÑÏàò)</span>
                                    </label>
                                    
                                    <label class="agreement-item">
                                        <input type="checkbox" th:field="*{agreeMarketing}" class="agreement-checkbox">
                                        <span class="checkmark"></span>
                                        <span class="agreement-text">ÎßàÏºÄÌåÖ Ï†ïÎ≥¥ ÏàòÏã† ÎèôÏùò (ÏÑ†ÌÉù)</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Ïò§Î•∏Ï™Ω: Ï£ºÎ¨∏ ÏöîÏïΩ Ï†ïÎ≥¥ -->
                        <div class="order-summary">
                            <!-- Ï£ºÎ¨∏ ÏÉÅÌíà Î™©Î°ù ÌëúÏãú -->
                            <div class="summary-section">
                                <h3>üõí Ï£ºÎ¨∏ ÏÉÅÌíà</h3>
                                <div class="order-items" id="orderItems">
                                    <!-- Thymeleaf Î∞òÎ≥µÎ¨∏ÏúºÎ°ú Ï£ºÎ¨∏ ÏÉÅÌíà Ï∂úÎ†• -->
                                    <div class="order-item" th:each="item : ${orderItems}">
                                        <div class="item-image">
                                            <img th:src="${item.product.imageUrl != null ? item.product.imageUrl : '/img/default-product.svg'}" 
                                                 th:alt="${item.product.name}">
                                        </div>
                                        <div class="item-info">
                                            <h4 th:text="${item.product.name}">ÏÉÅÌíàÎ™Ö</h4>
                                            <div class="item-details">
                                                <span th:text="'ÏàòÎüâ: ' + ${item.quantity} + 'Í∞ú'">ÏàòÎüâ: 2Í∞ú</span>
                                                <span th:text="${#numbers.formatInteger(item.product.salePrice * item.quantity, 3, 'COMMA')} + 'Ïõê'">32,000Ïõê</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Í≤∞Ï†ú Í∏àÏï° ÏöîÏïΩ -->
                            <div class="summary-section">
                                <h3>üí∞ Í≤∞Ï†ú Í∏àÏï°</h3>
                                <div class="price-summary">
                                    <!-- ÏÑúÎ≤ÑÏóêÏÑú Í≥ÑÏÇ∞Îêú Í∞ÄÍ≤© Ï†ïÎ≥¥ ÏÇ¨Ïö© -->
                                    <div class="price-row">
                                        <span>ÏÉÅÌíàÍ∏àÏï°</span>
                                        <span id="subtotal" th:text="${#numbers.formatInteger(orderSummary.subtotal, 3, 'COMMA')} + 'Ïõê'">55,500Ïõê</span>
                                    </div>
                                    <div class="price-row discount" th:if="${orderSummary.discount > 0}">
                                        <span>Ìï†Ïù∏Í∏àÏï°</span>
                                        <span id="discount" th:text="'-' + ${#numbers.formatInteger(orderSummary.discount, 3, 'COMMA')} + 'Ïõê'">-8,500Ïõê</span>
                                    </div>
                                    <div class="price-row">
                                        <span>Î∞∞ÏÜ°ÎπÑ</span>
                                        <span id="shipping" th:text="${orderSummary.shippingFee > 0 ? (#numbers.formatInteger(orderSummary.shippingFee, 3, 'COMMA') + 'Ïõê') : 'Î¨¥Î£å'}">Î¨¥Î£å</span>
                                    </div>
                                    <!-- Ïø†Ìè∞ Ìï†Ïù∏Ïù¥ ÏûàÏùÑ ÎïåÎßå ÌëúÏãú -->
                                    <div class="price-row coupon-discount" th:if="${orderSummary.couponDiscount > 0}" id="couponDiscountRow">
                                        <span>Ïø†Ìè∞Ìï†Ïù∏</span>
                                        <span id="couponDiscount" th:text="'-' + ${#numbers.formatInteger(orderSummary.couponDiscount, 3, 'COMMA')} + 'Ïõê'">-0Ïõê</span>
                                    </div>
                                    <div class="price-divider"></div>
                                    <div class="price-row total">
                                        <span>ÏµúÏ¢Ö Í≤∞Ï†úÍ∏àÏï°</span>
                                        <span id="finalTotal" th:text="${#numbers.formatInteger(orderSummary.total, 3, 'COMMA')} + 'Ïõê'">47,000Ïõê</span>
                                    </div>
                                </div>
                            </div>

                            <!-- ÌôòÍ≤Ω ÏûÑÌå©Ìä∏ Ï†ïÎ≥¥ ÌëúÏãú -->
                            <div class="summary-section">
                                <h3>üåç ÌôòÍ≤Ω ÏûÑÌå©Ìä∏</h3>
                                <div class="eco-impact">
                                    <div class="impact-item">
                                        <span>ÌÉÑÏÜåÎ∞úÏûêÍµ≠ Ï†àÏïΩ</span>
                                        <span class="impact-value" th:text="${orderSummary.totalCarbonSaved} + 'kg CO‚ÇÇ'">8.8kg CO‚ÇÇ</span>
                                    </div>
                                    <div class="impact-item">
                                        <span>ÌîåÎùºÏä§Ìã± ÏÇ¨Ïö© Ï†àÏïΩ</span>
                                        <span class="impact-value" th:text="${orderSummary.plasticSaved} + 'g'">450g</span>
                                    </div>
                                    <div class="impact-item">
                                        <span>Ï†ÅÎ¶Ω ÏòàÏ†ï Ìè¨Ïù∏Ìä∏</span>
                                        <span class="impact-value" th:text="${orderSummary.expectedPoints} + 'P'">470P</span>
                                    </div>
                                </div>
                            </div>

                            <!-- ÏµúÏ¢Ö Í≤∞Ï†ú Î≤ÑÌäº -->
                            <div class="payment-action">
                                <button type="submit" class="btn-payment" id="paymentBtn"
                                        th:text="'üí≥ ' + ${#numbers.formatInteger(orderSummary.total, 3, 'COMMA')} + 'Ïõê Í≤∞Ï†úÌïòÍ∏∞'">
                                    üí≥ 47,000Ïõê Í≤∞Ï†úÌïòÍ∏∞
                                </button>
                                <p class="payment-notice">
                                    Í≤∞Ï†ú Ïãú Í∞úÏù∏Ï†ïÎ≥¥Î≥¥Ìò∏Ï†ïÏ±ÖÍ≥º Ïù¥Ïö©ÏïΩÍ¥ÄÏóê ÎèôÏùòÌïú Í≤ÉÏúºÎ°ú Í∞ÑÏ£ºÎê©ÎãàÎã§.
                                </p>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </section>
    </main>

    <!-- Footer (Ïû•Î∞îÍµ¨ÎãàÏôÄ ÎèôÏùº) -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <div class="logo" style="margin-bottom: 20px;">
                        <span class="logo-icon">üå±</span>
                        <span class="logo-text">GreenCycle</span>
                    </div>
                    <p>Ï≤®Îã® Í∏∞Ïà†Î°ú Ïã§ÌòÑÌïòÎäî Ïä§ÎßàÌä∏ÌïòÍ≥† ÏßÄÏÜç Í∞ÄÎä•Ìïú ÌôòÍ≤Ω ÌîåÎû´Ìèº</p>
                </div>
                <div class="footer-section">
                    <h4>ÏÑúÎπÑÏä§</h4>
                    <ul>
                        <li><a th:href="@{/waste-sorting}">Ïä§ÎßàÌä∏ Î∂ÑÎ¶¨Î∞∞Ï∂ú</a></li>
                        <li><a th:href="@{/free-sharing}">Î¨¥Î£åÎÇòÎàî</a></li>
                        <li><a th:href="@{/eco-market}">ÏóêÏΩîÎßàÏºì</a></li>
                        <li><a th:href="@{/eco-talk}">ÌôòÍ≤ΩÎèÖÌÜ°</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Í≥†Í∞ùÏßÄÏõê</h4>
                    <ul>
                        <li><a th:href="@{/contact}">Î¨∏ÏùòÌïòÍ∏∞</a></li>
                        <li><a th:href="@{/guide}">Ïù¥Ïö©Í∞ÄÏù¥Îìú</a></li>
                        <li><a th:href="@{/delivery-policy}">Î∞∞ÏÜ°/ÍµêÌôò/ÌôòÎ∂à</a></li>
                        <li><a th:href="@{/customer-service}">Í≥†Í∞ùÏÑºÌÑ∞</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Ï†ïÏ±Ö</h4>
                    <ul>
                        <li><a th:href="@{/privacy-policy}">Í∞úÏù∏Ï†ïÎ≥¥Ï≤òÎ¶¨Î∞©Ïπ®</a></li>
                        <li><a th:href="@{/terms}">Ïù¥Ïö©ÏïΩÍ¥Ä</a></li>
                        <li><a th:href="@{/eco-policy}">ÏπúÌôòÍ≤Ω Ï†ïÏ±Ö</a></li>
                        <li><a th:href="@{/carbon-neutral}">ÌÉÑÏÜåÏ§ëÎ¶Ω Ïù∏Ï¶ù</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 GreenCycle. All rights reserved.</p>
                <div class="footer-links">
                    <a th:href="@{/privacy-policy}">Í∞úÏù∏Ï†ïÎ≥¥Ï≤òÎ¶¨Î∞©Ïπ®</a>
                    <a th:href="@{/terms}">Ïù¥Ïö©ÏïΩÍ¥Ä</a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Í≤∞Ï†ú Ï≤òÎ¶¨ Ï§ë Î™®Îã¨ -->
    <div id="paymentModal" class="payment-modal" style="display: none;">
        <div class="modal-content">
            <div class="loading-spinner"></div>
            <h3>Í≤∞Ï†ú Ï≤òÎ¶¨ Ï§ë...</h3>
            <p>Ïû†ÏãúÎßå Í∏∞Îã§Î†§Ï£ºÏÑ∏Ïöî.</p>
        </div>
    </div>

    <!-- JavaScript ÌååÏùº Ïó∞Í≤∞ - Thymeleaf Ï†ïÏ†Å Î¶¨ÏÜåÏä§ Í≤ΩÎ°ú -->
    <script th:src="@{/js/checkout.js}"></script>
    
    <!-- Ï£ºÎ¨∏ Îç∞Ïù¥ÌÑ∞Î•º JavaScriptÎ°ú Ï†ÑÎã¨ -->
    <script th:inline="javascript">
        // ÏÑúÎ≤ÑÏóêÏÑú Ï†ÑÎã¨Î∞õÏùÄ Ï£ºÎ¨∏ Îç∞Ïù¥ÌÑ∞Î•º JavaScript Î≥ÄÏàòÎ°ú ÏÑ§Ï†ï
        var orderData = /*[[${orderItems}]]*/ [];
        var orderSummaryData = /*[[${orderSummary}]]*/ {};
        var userPoints = /*[[${session.user.points}]]*/ 0;
        
        // Ï£ºÎ¨∏ Í¥ÄÎ†® JavaScript Ìï®ÏàòÎì§ÏóêÏÑú ÏÇ¨Ïö©Ìï† Ïàò ÏûàÎèÑÎ°ù Ï†ÑÏó≠ Î≥ÄÏàòÎ°ú ÏÑ§Ï†ï
        window.orderData = orderData;
        window.orderSummary = orderSummaryData;
        window.userPoints = userPoints;
    </script>
</body>
</html>