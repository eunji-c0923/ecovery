<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>에코마켓 수정/삭제 - 환경보호 플랫폼</title>
    <link rel="stylesheet" th:href="@{/css/eco-market-edit.css}">
</head>
<body>
    <!-- 헤더 포함 - 백엔드에서 불러오기 -->
    <div th:replace="fragments/header :: header"></div>

    <!-- 메인 콘텐츠 영역 -->
    <main class="main-content">
        <!-- 브레드크럼 네비게이션 -->
        <div class="breadcrumb">
            <a href="#"><i class="home-icon">🏠</i></a>
            <span>></span>
            <span>에코마켓</span>
        </div>

        <!-- 게시물 수정 폼 -->
        <form class="edit-form" id="editForm" th:action="@{/eco-market/update/{id}(id=${item.id})}" method="post">
            <div class="form-row">
                <!-- 제목 입력 -->
                <div class="form-group title-group">
                    <label for="title">제목</label>
                    <input type="text" id="title" name="title" 
                           placeholder="친환경 상품을 판매합니다." 
                           th:value="${item.title}">
                </div>
            </div>

            <div class="form-row">
                <!-- 작성자 -->
                <div class="form-group">
                    <label for="author">작성자</label>
                    <input type="text" id="author" name="author" 
                           th:value="${session.user.nickname}" readonly>
                </div>

                <!-- 상품상태 -->
                <div class="form-group">
                    <label for="condition">상품상태</label>
                    <select id="condition" name="condition">
                        <option value="상" th:selected="${item.condition == '상'}">상</option>
                        <option value="중" th:selected="${item.condition == '중'}">중</option>
                        <option value="하" th:selected="${item.condition == '하'}">하</option>
                    </select>
                </div>
            </div>

            <div class="form-row">
                <!-- 카테고리 -->
                <div class="form-group">
                    <label for="category">카테고리</label>
                    <select id="category" name="category">
                        <option value="친환경제품" th:selected="${item.category == '친환경제품'}">친환경제품</option>
                        <option value="리사이클링" th:selected="${item.category == '리사이클링'}">리사이클링</option>
                        <option value="업사이클링" th:selected="${item.category == '업사이클링'}">업사이클링</option>
                        <option value="제로웨이스트" th:selected="${item.category == '제로웨이스트'}">제로웨이스트</option>
                        <option value="기타" th:selected="${item.category == '기타'}">기타</option>
                    </select>
                </div>

                <!-- 판매상태 -->
                <div class="form-group">
                    <label for="status">판매상태</label>
                    <select id="status" name="status">
                        <option value="판매중" th:selected="${item.status == '판매중'}">판매중</option>
                        <option value="판매완료" th:selected="${item.status == '판매완료'}">판매완료</option>
                        <option value="판매대기" th:selected="${item.status == '판매대기'}">판매대기</option>
                    </select>
                </div>
            </div>

            <div class="form-row">
                <!-- 가격 -->
                <div class="form-group">
                    <label for="price">가격 (원)</label>
                    <input type="number" id="price" name="price" 
                           placeholder="0" min="0" max="999999999"
                           th:value="${item.price}">
                </div>

                <!-- 지역 선택 -->
                <div class="form-group">
                    <label for="region1">지역</label>
                    <select id="region1" name="region1">
                        <option value="00구" th:selected="${item.region1 == '00구'}">00구</option>
                        <option value="01구" th:selected="${item.region1 == '01구'}">01구</option>
                        <option value="02구" th:selected="${item.region1 == '02구'}">02구</option>
                    </select>
                </div>

                <div class="form-group">
                    <select id="region2" name="region2">
                        <option value="00동" th:selected="${item.region2 == '00동'}">00동</option>
                        <option value="01동" th:selected="${item.region2 == '01동'}">01동</option>
                        <option value="02동" th:selected="${item.region2 == '02동'}">02동</option>
                    </select>
                </div>
            </div>

            <!-- 상세설명 -->
            <div class="form-group description-group">
                <label for="description">상세설명</label>
                <textarea id="description" name="description" 
                          placeholder="상품 사이즈&#10;상품 설명&#10;거래 희망 날짜" 
                          th:text="${item.description}">상품 사이즈
상품 설명
거래 희망 날짜</textarea>
            </div>

            <!-- 파일 업로드 -->
            <div class="form-row upload-row">
                <button type="button" class="file-btn">정보파일</button>
                <button type="button" class="upload-btn">upload</button>
                <span class="file-info" id="fileInfo">선택된 파일이 없습니다</span>
            </div>

            <!-- 이미지 업로드 영역 -->
            <div class="image-upload-area">
                <div class="image-slots">
                    <div class="image-slot" data-index="0">
                        <span class="remove-btn">×</span>
                        <div class="upload-placeholder">+</div>
                    </div>
                    <div class="image-slot" data-index="1">
                        <span class="remove-btn">×</span>
                        <div class="upload-placeholder">+</div>
                    </div>
                    <div class="image-slot" data-index="2">
                        <span class="remove-btn">×</span>
                        <div class="upload-placeholder">+</div>
                    </div>
                    <div class="image-slot" data-index="3">
                        <span class="remove-btn">×</span>
                        <div class="upload-placeholder">+</div>
                    </div>
                    <div class="image-slot" data-index="4">
                        <span class="remove-btn">×</span>
                        <div class="upload-placeholder">+</div>
                    </div>
                </div>
            </div>

            <!-- 버튼 영역 -->
            <div class="button-group">
                <button type="button" class="btn btn-delete" id="deleteBtn">삭제</button>
                <button type="submit" class="btn btn-update">수정완료</button>
                <button type="button" class="btn btn-cancel" id="cancelBtn">취소</button>
            </div>
        </form>
    </main>

    <!-- 푸터 포함 - 백엔드에서 불러오기 -->
    <div th:replace="fragments/footer :: footer"></div>

    <!-- 파일 입력 (숨김) -->
    <input type="file" id="fileInput" accept=".pdf,.doc,.docx,.txt" style="display: none;">
    <input type="file" id="imageInput" accept="image/*" multiple style="display: none;">

    <!-- JavaScript 파일 연결 -->
    <script th:src="@{/js/eco-market-edit.js}"></script>
    
    <!-- 페이지 데이터를 JavaScript로 전달 -->
    <script th:inline="javascript">
        // 서버에서 전달받은 데이터를 JavaScript 변수로 설정
        var itemData = /*[[${item}]]*/ {};
        var currentUser = /*[[${session.user}]]*/ null;
        
        // 전역 변수로 설정하여 JavaScript 함수들에서 사용
        window.itemData = itemData;
        window.currentUser = currentUser;
    </script>
</body>
</html>